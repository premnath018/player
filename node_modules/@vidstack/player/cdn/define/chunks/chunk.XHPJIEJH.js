import{a as U}from"./chunk.KBK5USFX.js";import{a as $}from"./chunk.VDAPKEID.js";import{b as W,c as B,d as G,e as f}from"./chunk.X5B2OXGH.js";import{$ as V,B as _,C as L,D,I as R,O as F,Q as q,R as b,X as x,Y as A,a as h,aa as v,b as k,ea as I,g as S,h as T,i as p,ja as N,m as n,n as r,oa as O,p as o,pa as Q,q as i,qa as H,ra as m,w as C,x as u,y as c}from"./chunk.DPV5XUTO.js";var y=class{constructor(e,t){this.i=e;this.q=t;this.qi=!1;this.Hi=!1;this.Oi=!1;this.s=new n;this.delay=2e3;e.addController(this)}get paused(){return this.Oi||this.Hi}set paused(e){this.Oi=e,this.Ne()}hostConnected(){this.s.add(this.q.paused.subscribe(t=>{this.Hi=t,this.Ne()})),["pointerdown","pointermove","focus","keydown"].forEach(t=>{let s=p(this.i,t,this.Ne.bind(this));this.s.add(s)})}hostDisconnected(){this.s.empty(),this._t()}Ne(){this.paused?this._t():this.us()}us(){this._t(),this.Ai=window.setTimeout(()=>{this.Ni(!this.paused)},this.delay)}_t(){window.clearTimeout(this.Ai),this.Ni(!1)}Ni(e){this.qi!==e&&(this.i.dispatchEvent(o("vds-user-idle-change",{detail:e})),this.qi=e)}};var g=class{constructor(e){this.i=e;this.J=new n;this.providerQueue=new F;this.providerDisposal=new n;this.hs=void 0;this.z=void 0;this.Fi=U.provide(this.i);this.Ui=G.provide(this.i);this.state=A(this.e);this.Fe=new y(this.i,this.e);this.Ne=r(this.i,"vds-user-idle-change",e=>{this.e.userIdle.set(e.detail),this.j("userIdle",e)});this.a={loading:[],play:[],pause:[],volume:[],fullscreen:[],seeked:[],seeking:[],userIdle:[]};this.Fn=r(this.i,"vds-start-loading",this.y("loading",e=>{this.state.canLoad||(this.a.loading.push(e),this.r.startLoadingMedia())}));this.In=r(this.i,"vds-mute-request",this.y("muted",e=>{this.state.muted||(this.a.volume.push(e),this.provider.muted=!0)}));this.Un=r(this.i,"vds-unmute-request",this.y("muted",e=>{!this.state.muted||(this.a.volume.push(e),this.provider.muted=!1,this.state.volume===0&&(this.a.volume.push(e),this.provider.volume=.25))}));this.$n=r(this.i,"vds-play-request",this.y("paused",e=>{!this.state.paused||(this.a.play.push(e),this.provider.paused=!1)}));this.Bn=r(this.i,"vds-pause-request",this.y("paused",e=>{this.state.paused||(this.a.pause.push(e),this.provider.paused=!0)}));this.At=!1;this.jn=r(this.i,"vds-seeking-request",this.y("seeking",e=>{this.ne(),this.a.seeking.push(e),this.At=!0,this.e.seeking.set(!0)}));this.Gn=r(this.i,"vds-seek-request",this.y("seeking",e=>{this.store.ended&&(this.ue=!0),this.a.seeked.push(e),this.At=!1;let t=e.detail;this.state.duration-e.detail<.25&&(t=this.state.duration),this.provider.currentTime=t}));this.Wn=r(this.i,"vds-volume-change-request",this.y("volume",e=>{let t=e.detail;this.state.volume!==t&&(this.a.volume.push(e),this.provider.volume=t,t>0&&this.state.muted&&(this.a.volume.push(e),this.provider.muted=!1))}));this.zn=r(this.i,"vds-enter-fullscreen-request",this.y("fullscreen",async e=>{if(this.state.fullscreen)return;(e.detail??"media")==="media"&&this.i.canFullscreen?(this.a.fullscreen.push(e),await this.i.enterFullscreen?.()):this.provider&&(this.a.fullscreen.push(e),await this.provider.enterFullscreen())}));this.Qn=r(this.i,"vds-exit-fullscreen-request",this.y("fullscreen",async e=>{if(!this.state.fullscreen)return;(e.detail??"media")==="media"&&this.i.canFullscreen?(this.a.fullscreen.push(e),await this.i.exitFullscreen?.()):this.provider&&(this.a.fullscreen.push(e),await this.provider.exitFullscreen())}));this.Kn=r(this.i,"vds-resume-user-idle-request",e=>{!this.qt(e)||(this.a.userIdle.push(e),this.Fe.paused=!1)});this.Yn=r(this.i,"vds-pause-user-idle-request",e=>{!this.qt(e)||(this.a.userIdle.push(e),this.Fe.paused=!0)});this.Jn=r(this.i,"vds-show-poster-request",this.y("poster",()=>{this.r.canLoadPoster=!0}));this.Xn=r(this.i,"vds-hide-poster-request",this.y("poster",()=>{this.r.canLoadPoster=!1}));this.vs=this.y("loop",()=>{window.requestAnimationFrame(async()=>{try{this.X=!0,this.ue=!0,await this.r.play()}catch{this.ue=!1,this.X=!1}})});this.yt=r(this.i,"vds-fullscreen-change",e=>{this.e.fullscreen.set(e.detail),e.target===this.i&&(this.j("fullscreen",e),this.r?.dispatchEvent(o("vds-fullscreen-change",{detail:e.detail,triggerEvent:e})))});this.wi=r(this.i,"vds-fullscreen-error",e=>{e.target===this.i&&(this.j("fullscreen",e),this.r?.dispatchEvent(o("vds-fullscreen-error",{detail:e.detail,triggerEvent:e})))});this.ue=!1;this.X=!1;this.Ie=!1;this.f=[];this.Bt=T(e=>{this.f.push(e),this.e.seeking.set(!0),this.e.currentTime.set(e.detail),this.j("seeking",e)},150,{leading:!0});this.Bi=S(()=>{if(!this.Me)return;this.Ie=!0;let e=o("vds-waiting",this.Me);this.f.push(e),this.e.waiting.set(!0),this.e.playing.set(!1),this.r?.dispatchEvent(e),this.Me=void 0,this.Ie=!1},300);this.Vt=!0;_(e,$,(t,s)=>{this.attachMediaProvider(t,s)}),e.addController({hostConnected:()=>{this.state.canPlay||this.i.setAttribute("aria-busy","true")},hostDisconnected:()=>{this.se(),this.cs(),this.providerQueue.destroy(),this.providerDisposal.empty(),this.Vt=!0,this.J.empty()}})}get logLevel(){return this.hs?.logLevel??"silent"}set logLevel(e){}get provider(){return this.r}attachMediaProvider(e,t){!C(this.provider)||this.provider===e||(this.Ii(),this.r=e,this.Fi.value.set(e),x(this.r.e,this.e),this.Dt(),e.attachMediaController(this,s=>this.J.add(s)),this.ps(),t(this.Ii.bind(this)))}Ii(){C(this.provider)||(this.ne(),this.providerQueue.destroy(),this.providerDisposal.empty(),this.r=void 0,this.Fi.value.set(void 0),B(this.e),this.e.viewType.set("unknown"))}ps(){this.providerQueue.start(),this.providerDisposal.add(()=>{this.providerQueue.stop()})}get store(){return this.Ui.value}get e(){return this.Ui.value}get idleDelay(){return this.Fe.delay}set idleDelay(e){this.Fe.delay=e}cs(){b(this.a).forEach(e=>{this.a[e]=[]})}j(e,t){let s=this.a[e].shift();s&&(t.requestEvent=s,i(t,s))}qt(e){return e.stopPropagation(),!0}y(e,t){return s=>{if(!!this.qt(s)){if(this.r){t(s);return}this.providerQueue.queue(e,()=>{t(s)})}}}Dt(){if(!this.r)return;let e={"vds-can-load":this.ms,"vds-load-start":this.Ht,"vds-loaded-data":this.Ot,"vds-loaded-metadata":this.xe,"vds-can-play":this.Pe,"vds-can-play-through":this.Nt,"vds-current-src-change":this.He,"vds-autoplay":this.fs,"vds-autoplay-fail":this.gs,"vds-loop-request":this.vs,"vds-play":this.Ft,"vds-play-fail":this.ys,"vds-playing":this.It,"vds-pause":this.Ut,"vds-time-update":this.Es,"vds-volume-change":this.$t,"vds-seeking":this.Bt,"vds-seeked":this.jt,"vds-waiting":this.Gt,"vds-ended":this.Wt,"vds-autoplay-change":this.bs,"vds-error":this.Le,"vds-fullscreen-support-change":this.ws,"vds-poster-change":this.Cs,"vds-loop-change":this.Ss,"vds-playsinline-change":this.Ue,"vds-controls-change":this.Ms,"vds-media-type-change":this.xs,"vds-view-type-change":this.Ps,"vds-duration-change":this.zt,"vds-progress":this.Qt,"vds-src-change":this.ce};for(let t of b(e)){let s=e[t].bind(this);this.providerDisposal.add(p(this.r,t,s))}}se(){this.ue=!1,this.X=!1,this.Ie=!1,this.Me=void 0,this.f=[]}l(e){return this.f[this.f.map(t=>t.type).lastIndexOf(e)]}ms(e){this.e.canLoad.set(!0),this.f.push(e),this.j("loading",e)}$i(e){this.e.currentSrc.set(e.currentSrc),this.e.mediaType.set(e.mediaType),this.e.viewType.set(e.viewType)}Ht(e){this.$i(e.detail),this.f.push(e),i(e,this.l("vds-src-change")),i(e,this.l("vds-can-load"))}Ot(e){this.f.push(e),i(e,this.l("vds-load-start"))}xe(e){this.$i(e.detail),this.f.push(e),i(e,this.l("vds-load-start"))}Pe(e){this.f.push(e),e.triggerEvent?.type!=="loadedmetadata"&&i(e,this.l("vds-loaded-metadata")),this.e.canPlay.set(!0),this.e.duration.set(e.detail.duration),this.i.setAttribute("aria-busy","false")}Nt(e){this.e.canPlay.set(!0),this.e.duration.set(e.detail.duration),i(e,this.l("vds-can-play"))}fs(e){this.f.push(e),i(e,this.l("vds-play")),i(e,this.l("vds-can-play")),this.e.autoplayError.set(void 0)}gs(e){i(e,this.l("vds-play-fail")),i(e,this.l("vds-can-play")),this.e.autoplayError.set(e.detail),this.se()}Ft(e){if(this.X||!this.state.paused){e.stopImmediatePropagation();return}if(this.f.push(e),i(e,this.l("vds-waiting")),this.j("play",e),this.e.paused.set(!1),this.e.autoplayError.set(void 0),this.state.ended||this.ue){this.ue=!1,this.e.ended.set(!1);let t=o("vds-replay",{triggerEvent:e});this.r?.dispatchEvent(t)}}ys(e){this.f.push(e),this.ne(),i(e,this.l("vds-play")),this.e.paused.set(!0),this.e.playing.set(!1),this.j("play",e),this.se()}It(e){this.f.push(e);let t=this.l("vds-play");if(t?(i(e,this.l("vds-waiting")),i(e,t)):i(e,this.l("vds-seeked")),this.ne(),this.se(),this.e.paused.set(!1),this.e.playing.set(!0),this.e.seeking.set(!1),this.e.ended.set(!1),this.X){e.stopImmediatePropagation(),this.X=!1;return}this.state.started||(this.e.started.set(!0),this.r?.dispatchEvent(o("vds-started",{triggerEvent:e})))}Ut(e){if(this.X){e.stopImmediatePropagation();return}i(e,this.l("vds-seeked")),this.j("pause",e),this.e.paused.set(!0),this.e.playing.set(!1),this.e.seeking.set(!1),this.ne(),this.se()}Es(e){let{currentTime:t,played:s}=e.detail;this.e.currentTime.set(t),this.e.played.set(s),this.e.waiting.set(!1)}$t(e){this.e.volume.set(e.detail.volume),this.e.muted.set(e.detail.muted||e.detail.volume===0),this.j("volume",e)}jt(e){this.At?(this.e.seeking.set(!0),e.stopImmediatePropagation()):this.state.seeking&&(this.f.push(e),i(e,this.l("vds-waiting")),i(e,this.l("vds-seeking")),this.state.paused&&this.ne(),this.e.seeking.set(!1),e.detail!==this.state.duration&&this.e.ended.set(!1),this.e.currentTime.set(e.detail),this.j("seeked",e))}ne(){this.Bi.cancel(),this.e.waiting.set(!1)}Gt(e){this.Ie||(e.stopImmediatePropagation(),this.Me=e,this.Bi())}Wt(e){if(this.X){e.stopImmediatePropagation();return}this.ne(),this.e.paused.set(!0),this.e.playing.set(!1),this.e.seeking.set(!1),this.e.ended.set(!0),this.se()}bs(e){this.e.autoplay.set(e.detail)}He(e){if(this.e.currentSrc.set(e.detail),this.Vt){this.Vt=!1;return}this.se(),W(this.e),this.i.setAttribute("aria-busy","true")}Le(e){this.e.error.set(e.detail)}ws(e){this.e.canFullscreen.set(e.detail)}Cs(e){this.e.poster.set(e.detail)}Ss(e){this.e.loop.set(e.detail)}Ue(e){this.e.playsinline.set(e.detail)}Ms(e){this.e.controls.set(e.detail)}xs(e){this.e.mediaType.set(e.detail)}zt(e){let t=e.detail;this.e.duration.set(isNaN(t)?0:t)}Qt(e){let{buffered:t,seekable:s}=e.detail,E=t.length===0?0:t.end(t.length-1),M=s.length===0?0:s.end(s.length-1);this.e.buffered.set(t),this.e.bufferedAmount.set(E),this.e.seekable.set(s),this.e.seekableAmount.set(M)}ce(e){this.e.src.set(e.detail)}Ps(e){this.e.viewType.set(e.detail)}};var l=class{constructor(e,t,s){this.i=e;this.e=t;this.Qi=s;this.s=new n;this.i.addController({hostConnected:this._s.bind(this),hostDisconnected:this.Vs.bind(this)})}_s(){I(()=>{for(let e of this.Qi){let t=this.e[e];if(t){let s=this.Ki(e),E=t.subscribe(M=>{window?.requestAnimationFrame(()=>{this.Yi(e,s,M)})});this.s.add(E)}}})}Vs(){for(let e of this.Qi)this.Ji(e,this.Ki(e));this.s.empty()}Ki(e){return N(e)}};var w=class extends l{Yi(e,t,s){window.requestAnimationFrame(()=>{v(this.i,t,c(s)||u(s)?String(s):!!s)})}Ji(e,t){this.i.removeAttribute(t)}};function K(...a){return new w(...a)}var P=class extends l{Yi(e,t,s){window.requestAnimationFrame(()=>{this.i.style.setProperty(this.Xi(t),c(s)||u(s)?String(s):null)})}Xi(e){return`--vds-${e}`}Ji(e,t){this.i.style.setProperty(this.Xi(t),null)}};function j(...a){return new P(...a)}var z=Symbol("@vidstack/media-discovery"),d=class extends Q{constructor(){super();this.controller=new g(this);this.__mediaFullscreen=!1;this.__mediaIsVideoView=!1;this.__mediaPlaysinline=!1;this.screenOrientationController=new q(this);this.fullscreenController=new R(this,this.screenOrientationController);L(this,"vds-media-connect",{register:z}),f(this,"fullscreen",t=>{this.__mediaFullscreen=t}),f(this,"viewType",t=>{this.__mediaIsVideoView=t==="video"}),f(this,"playsinline",t=>{this.__mediaPlaysinline=t}),this.Ds(),this.qs()}static get styles(){return[O`:host{display:inline-block;position:relative;contain:content}:host([hidden]){display:none}`]}get provider(){return this.controller.provider}update(t){v(this,"hide-ui",this.As()),super.update(t)}render(){return k`<slot></slot>`}get canFullscreen(){return this.fullscreenController.isSupported}get fullscreen(){return this.fullscreenController.isFullscreen}get fullscreenOrientation(){return this.fullscreenController.screenOrientationLock}set fullscreenOrientation(t){let s=this.fullscreenController.screenOrientationLock;s!==t&&(this.fullscreenController.screenOrientationLock=t,this.requestUpdate("fullscreen-orientation",s))}enterFullscreen(){return this.fullscreenController.enterFullscreen()}exitFullscreen(){return this.fullscreenController.exitFullscreen()}Ds(){K(this,this.controller.store,["autoplay","autoplayError","canLoad","canPlay","canFullscreen","ended","error","fullscreen","userIdle","loop","mediaType","muted","paused","playing","playsinline","seeking","started","viewType","waiting"])}qs(){j(this,this.controller.store,["bufferedAmount","currentTime","duration","seekableAmount"])}As(){return D&&this.__mediaIsVideoView&&(!this.__mediaPlaysinline||this.__mediaFullscreen)}};h([m()],d.prototype,"__mediaFullscreen",2),h([m()],d.prototype,"__mediaIsVideoView",2),h([m()],d.prototype,"__mediaPlaysinline",2),h([H({attribute:"fullscreen-orientation"})],d.prototype,"fullscreenOrientation",1);V("vds-media",d);
