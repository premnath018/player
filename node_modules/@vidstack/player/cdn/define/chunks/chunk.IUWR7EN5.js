import{b as y}from"./chunk.VDAPKEID.js";import{H as d,R as E,Z as u,a as l,aa as v,da as g,i as m,m as c,p as i,qa as f,v as a,w as r,x as p}from"./chunk.DPV5XUTO.js";var _=/\.(m4a|mp4a|mpga|mp2|mp2a|mp3|m2a|m3a|wav|weba|aac|oga|spx)($|\?)/i,w=/\.(mp4|og[gv]|webm|mov|m4v|avi)($|\?)/i;function T(n){return _.test(n)?"audio":w.test(n)?"video":"unknown"}var o=class extends y{constructor(){super(...arguments);this.preload="metadata";this.ve=void 0;this.Ye=!1;this.Je=new c;this.pe=!1;this.di=!1;this.li=!1}get mediaElement(){return this.ai}disconnectedCallback(){this.pe=!1,super.disconnectedCallback(),this.Ke()}destroy(){this.mediaElement&&(this.mediaElement.pause(),this.mediaElement.src="",this.mediaElement.innerHTML="",this.mediaElement.load()),super.destroy()}Ke(){p(this.ve)&&window.cancelAnimationFrame(this.ve),this.ve=void 0}ln(){!a(this.ve)||this.br()}br(){let e=this.mediaElement?.currentTime??0;this.state.currentTime!==e&&this.he(e),this.ve=window.requestAnimationFrame(()=>{a(this.ve)||this.br()})}he(e,t){this.dispatchEvent(i("vds-time-update",{detail:{currentTime:Math.min(e,this.mediaElement?.duration??0),played:this.mediaElement.played},triggerEvent:t}))}handleDefaultSlotChange(){this.wr(),this.Cr()}get un(){return this.canLoad&&!r(this.mediaElement)&&!this.Ye}cn(){let e=g(this)[0],t=e?.tagName??"";/^(audio|video)$/i.test(t),this.ai=e??void 0}Cr(){window.requestAnimationFrame(()=>{if(this.cn(),!this.un)return;let e=this.mediaElement;e.hasAttribute("loop")&&(this.loop=!0),e.removeAttribute("loop"),e.removeAttribute("poster"),v(e,"controls",this.controls),!this.state.canFullscreen&&this.fullscreenController.isSupported&&this.dispatchEvent(i("vds-fullscreen-support-change",{detail:this.canFullscreen})),this.Dt(),this.hn(),this.pn(),this.canLoadPoster&&this.poster.length>0&&e.getAttribute("poster")!==this.poster&&e.setAttribute("poster",this.poster),this.vn(),this.Ye=!0,this.J.add(this.wr.bind(this))})}wr(){this.Ke(),window.requestAnimationFrame(()=>{this.Je.empty(),this.ai=void 0}),this.Ye,this.Ye=!1}startLoadingMedia(){super.startLoadingMedia(),this.Cr()}vn(){if(this.state.canPlay)return;this.mediaElement.setAttribute("preload",this.preload);let e=this.mediaElement.networkState>=1;this.di=e,this.li=e,this.mediaElement.load(),setTimeout(()=>{this.di=!1,this.li=!1},0)}hn(){let e=()=>this.mediaElement.hasAttribute("playsinline");this.Ue(e());let t=new MutationObserver(()=>this.Ue(e()));t.observe(this.mediaElement,{attributeFilter:["playsinline"]}),this.Je.add(()=>t.disconnect())}Ue(e){this.dispatchEvent(i("vds-playsinline-change",{detail:e}))}pn(){this.ce(this.Sr());let e=new MutationObserver(()=>this.ce(this.Sr()));e.observe(this.mediaElement,{attributeFilter:["src"],subtree:!0}),this.Je.add(()=>e.disconnect())}ce(e){let t=this.state.src;u(t,e)||this.dispatchEvent(i("vds-src-change",{detail:e}))}Sr(){let e=[this.mediaElement?.src,...Array.from(this.mediaElement?.querySelectorAll("source")??[]).map(t=>t.src)].filter(Boolean);return Array.from(new Set(e))}Mr(){return{src:this.state.src,currentSrc:this.mediaElement.currentSrc,duration:this.mediaElement.duration||0,poster:this.mediaElement.poster,mediaType:this.Xe(),viewType:this.state.viewType}}Dt(){if(r(this.mediaElement))return;let e={abort:this.Ze,canplay:this.Pe,canplaythrough:this.Nt,durationchange:this.zt,emptied:this.mn,ended:this.Wt,error:this.Le,loadeddata:this.Ot,loadedmetadata:this.xe,loadstart:this.Ht,pause:this.Ut,play:this.Ft,playing:this.It,progress:this.Qt,ratechange:this.fn,seeked:this.jt,seeking:this.Bt,stalled:this.gn,suspend:this.yn,volumechange:this.$t,waiting:this.Gt};E(e).forEach(t=>{let s=e[t].bind(this),h=m(this.mediaElement,t,async b=>{await s(b)});this.Je.add(h)})}Ze(e){this.di||(this.dispatchEvent(i("vds-abort",{triggerEvent:e})),this.He("",e))}Pe(e){this.Vi({event:e,duration:this.mediaElement.duration})}Nt(e){this.state.started||this.dispatchEvent(i("vds-can-play-through",{triggerEvent:e,detail:{duration:this.mediaElement.duration}}))}Ht(e){if(this.He(this.mediaElement.currentSrc,e),this.mediaElement.currentSrc===""){this.Ze();return}this.dispatchEvent(i("vds-load-start",{triggerEvent:e,detail:this.Mr()}))}mn(e){this.li||this.dispatchEvent(i("vds-emptied",{triggerEvent:e}))}Ot(e){this.dispatchEvent(i("vds-loaded-data",{triggerEvent:e}))}xe(e){this.dispatchEvent(i("vds-volume-change",{detail:{volume:this.mediaElement.volume,muted:this.mediaElement.muted}})),this.dispatchEvent(i("vds-loaded-metadata",{triggerEvent:e,detail:this.Mr()}))}po(e){this.dispatchEvent(i("vds-media-type-change",{detail:this.Xe(),triggerEvent:e}))}Ft(e){let t=i("vds-play",{triggerEvent:e});t.autoplay=this.Oe,this.dispatchEvent(t)}Ut(e){this.mediaElement.readyState===1&&!this.pe||(this.pe=!1,this.Ke(),this.dispatchEvent(i("vds-pause",{triggerEvent:e})))}It(e){this.pe=!1;let t=i("vds-playing",{triggerEvent:e});this.dispatchEvent(t),this.ln()}zt(e){this.mediaElement.ended&&this.he(this.mediaElement.duration,e),this.dispatchEvent(i("vds-duration-change",{detail:this.mediaElement.duration,triggerEvent:e}))}Qt(e){this.dispatchEvent(i("vds-progress",{triggerEvent:e,detail:{buffered:this.mediaElement.buffered,seekable:this.mediaElement.seekable}}))}fn(e){throw Error("Not implemented")}Bt(e){this.dispatchEvent(i("vds-seeking",{detail:this.mediaElement.currentTime,triggerEvent:e}))}jt(e){let t=i("vds-seeked",{detail:this.mediaElement.currentTime,triggerEvent:e});this.dispatchEvent(t);let s=this.mediaElement.currentTime;if(Math.trunc(s)===Math.trunc(this.mediaElement.duration)&&d(this.mediaElement.duration)>d(s)&&(this.he(this.mediaElement.duration,e),!this.mediaElement.ended))try{this.play()}catch{}}gn(e){this.dispatchEvent(i("vds-stalled",{triggerEvent:e})),this.mediaElement.readyState<3&&(this.pe=!0,this.dispatchEvent(i("vds-waiting",{triggerEvent:e})))}$t(e){this.dispatchEvent(i("vds-volume-change",{detail:{volume:this.mediaElement.volume,muted:this.mediaElement.muted},triggerEvent:e}))}Gt(e){this.mediaElement.readyState<3&&(this.pe=!0,this.dispatchEvent(i("vds-waiting",{triggerEvent:e})))}yn(e){let t=i("vds-suspend",{triggerEvent:e});this.dispatchEvent(t)}Wt(e){this.Ke(),this.he(this.mediaElement.duration,e);let t=i("vds-end",{triggerEvent:e});this.dispatchEvent(t),this.state.loop?this.En():this.dispatchEvent(i("vds-ended",{triggerEvent:e}))}En(){r(this.controls)&&(this.mediaElement.controls=!1),this.dispatchEvent(i("vds-loop-request"))}Le(e){let t=this.mediaElement.error;!t||this.dispatchEvent(i("vds-error",{detail:{message:t.message,code:t.code,mediaError:t},triggerEvent:e}))}rs(){return this.mediaElement?.paused??!0}ts(){return this.mediaElement?.volume??1}is(e){this.mediaElement.volume=e}ss(){return this.mediaElement?.currentTime??0}_i(e){this.mediaElement.currentTime!==e&&(this.mediaElement.currentTime=e)}ns(){return this.mediaElement?.muted??!1}os(e){this.mediaElement.muted=e}async play(){try{return this.as(),await this.ds(),this.mediaElement?.play()}catch(e){let t=i("vds-play-fail");throw t.autoplay=this.Oe,t.error=e,e}}async pause(){return this.mediaElement?.pause()}Xe(){return T(this.state.currentSrc)}};l([f()],o.prototype,"preload",2);export{o as a};
