import{a as c}from"./chunk.X5B2OXGH.js";import{C as v,G as y,I as g,L as f,O as n,P as m,Q as b,X as C,Y as l,_ as d,a as r,b as u,ea as _,m as h,p as o,pa as L,qa as i,ra as E,v as p}from"./chunk.DPV5XUTO.js";var D=Symbol("@vidstack/media-provider-discovery"),s=class extends L{constructor(){super();this.J=new h;this.z=void 0;this.loading="visible";this.Oe=!1;this.controllerQueue=new n;this.e=c();this.Q=l(this.e);this.connectedQueue=m(this);this.mediaQueue=new n;this.screenOrientationController=new b(this);this.fullscreenController=new g(this,this.screenOrientationController);v(this,"vds-media-provider-connect",{register:D});let e=f(this,{target:this,threshold:0},t=>{if(!/(visible|lazy)/.test(this.loading)){e.hostDisconnected();return}t[0]?.isIntersecting&&(this.startLoadingMedia(),e.hostDisconnected())})}connectedCallback(){super.connectedCallback(),this.es(),window.requestAnimationFrame(()=>{p(this.canLoadPoster)&&(this.canLoadPoster=!0)})}firstUpdated(e){super.firstUpdated(e),this.dispatchEvent(o("vds-fullscreen-support-change",{detail:this.canFullscreen})),this.canLoad||this.loading==="eager"?window?.requestAnimationFrame(()=>{this.startLoadingMedia()}):this.loading==="idle"&&_(()=>{this.startLoadingMedia()})}render(){return u`<slot @slotchange="${this.handleDefaultSlotChange}"></slot>`}disconnectedCallback(){this.Ri(this.e),this.mediaQueue.destroy(),this.J.empty(),super.disconnectedCallback(),d(()=>{d(()=>{this.isConnected||this.destroy()})})}Ri(e){e.paused.set(!0),e.playing.set(!1),e.seeking.set(!1),e.waiting.set(!1),e.fullscreen.set(!1)}destroy(){this.isConnected&&this.disconnectedCallback(),this.dispatchEvent(o("vds-destroy"))}es(){}get volume(){return this.ts()}set volume(e){this.mediaQueue.queue("volume",()=>{let t=this.volume,a=y(0,e,1);t!==a&&(this.is(a),this.requestUpdate("volume",t))})}get paused(){return this.rs()}set paused(e){this.mediaQueue.queue("paused",()=>{if(this.paused!==e)try{e?this.pause():this.play(),this.requestUpdate("paused",!e)}catch(t){this.z?.error("paused-change-fail",t)}})}get currentTime(){return this.ss()}set currentTime(e){this.mediaQueue.queue("current-time",()=>{let t=this.currentTime;t!==e&&(this._i(e),this.requestUpdate("currentTime",t))})}get muted(){return this.ns()}set muted(e){this.mediaQueue.queue("muted",()=>{let t=this.muted;t!==e&&(this.os(e),this.requestUpdate("muted",t))})}get poster(){return this.state.poster}set poster(e){let t=this.poster;t!==e&&(this.dispatchEvent(o("vds-poster-change",{detail:e})),this.requestUpdate("poster",t))}get loop(){return this.state.loop}set loop(e){let t=this.loop;t!==e&&(this.dispatchEvent(o("vds-loop-change",{detail:e})),this.requestUpdate("loop",t))}get controls(){return this.state.controls}set controls(e){let t=this.controls;t!==e&&(this.dispatchEvent(o("vds-controls-change",{detail:e})),this.requestUpdate("controls",t))}get canLoad(){return this.state.canLoad}startLoadingMedia(){this.state.canPlay||this.dispatchEvent(o("vds-can-load"))}as(){if(!this.state.canPlay)throw Error("Media is not ready - wait for `vds-can-play` event.")}async ds(){if(!(!this.state.ended||this.state.currentTime===0))return this._i(0)}Nn(){if(this.state.viewType!=="video")throw Error("Player is currently not in a video view.")}async Vi({event:e,duration:t}){this.state.canPlay||(this.dispatchEvent(o("vds-can-play",{triggerEvent:e,detail:{duration:t}})),this.mediaQueue.start(),await this.Di())}He(e,t){this.state.currentSrc!==e&&(this.mediaQueue.stop(),this.dispatchEvent(o("vds-current-src-change",{detail:e,triggerEvent:t})))}get autoplay(){return this.state.autoplay}set autoplay(e){this.autoplay!==e&&(this.dispatchEvent(o("vds-autoplay-change",{detail:e})),this.requestUpdate("autoplay",!e)),this.Di()}get ls(){return this.state.canPlay&&this.state.autoplay&&!this.state.started}async Di(){if(!!this.ls){this.Oe=!0;try{await this.play(),this.dispatchEvent(o("vds-autoplay",{detail:{muted:this.muted}}))}catch(e){this.dispatchEvent(o("vds-autoplay-fail",{detail:{muted:this.muted,error:e}})),this.requestUpdate()}this.Oe=!1}}get controller(){return this._}get logLevel(){return this._?.logLevel??"silent"}set logLevel(e){}get idleDelay(){return this._?.idleDelay??0}set idleDelay(e){this.controllerQueue.queue("idle-delay",()=>{this._.idleDelay=e})}attachMediaController(e,t){this._=e,this.e=e.e,this.Q=e.state,this.controllerQueue.start(),t(()=>{this.controllerQueue.destroy(),this.e=c(),this.Q=l(this.e),this._&&(C(this._.e,this.e),this.Ri(this._.e)),this._=void 0})}dispatchEvent(e){return!this._&&e.type.startsWith("vds-")&&e.type!=="vds-destroy"?(this.controllerQueue.queue(e.type,()=>{super.dispatchEvent(e)}),!1):super.dispatchEvent(e)}store(){return this.e}get state(){return this.Q}get canFullscreen(){return this.fullscreenController.isSupported}get fullscreen(){return this.fullscreenController.isFullscreen}get fullscreenOrientation(){return this.fullscreenController.screenOrientationLock}set fullscreenOrientation(e){let t=this.fullscreenController.screenOrientationLock;t!==e&&(this.fullscreenController.screenOrientationLock=e,this.requestUpdate("fullscreen-orientation",t))}enterFullscreen(){return this.fullscreenController.enterFullscreen()}exitFullscreen(){return this.fullscreenController.exitFullscreen()}};r([i({type:Number})],s.prototype,"volume",1),r([i({type:Boolean})],s.prototype,"paused",1),r([i({type:Number})],s.prototype,"currentTime",1),r([i({type:Boolean})],s.prototype,"muted",1),r([i()],s.prototype,"poster",1),r([i({type:Boolean})],s.prototype,"loop",1),r([i({type:Boolean})],s.prototype,"controls",1),r([E()],s.prototype,"canLoadPoster",2),r([i({attribute:"loading"})],s.prototype,"loading",2),r([i({type:Boolean})],s.prototype,"autoplay",1),r([i({attribute:"log-level"})],s.prototype,"logLevel",1),r([i({attribute:"idle-delay",type:Number})],s.prototype,"idleDelay",1),r([i({attribute:"fullscreen-orientation"})],s.prototype,"fullscreenOrientation",1);export{D as a,s as b};
