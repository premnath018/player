import{a as k}from"./chunk.KBK5USFX.js";import{d as C,e as x}from"./chunk.X5B2OXGH.js";import{$ as M,N as E,S as w,a as c,g as m,i as f,j as y,k as u,l as g,m as v,oa as T,p as b,pa as P,qa as l}from"./chunk.DPV5XUTO.js";var h=new Map,o=class extends P{constructor(){super();this.Zi=!1;this.s=new v;this.repeat=0;this.priority=10;this.whileIdle=!1;this.tr=0;this.Be=!1;this.ei=C.consume(this);w(this,k,e=>{this.ee=e}),x(this,"userIdle",m(e=>{this.Zi=e},300))}static get styles(){return[T`:host{display:block;contain:content;z-index:0;opacity:0;visibility:hidden;pointer-events:none!important}:host([hidden]){display:none}`]}get $e(){return this.ee?h.get(this.ee):void 0}get er(){return this.$e?.get(this)}connectedCallback(){super.connectedCallback(),window.requestAnimationFrame(()=>{this.ee&&h.set(this.ee,new Map)})}willUpdate(e){this.Hs(),this.Os(),this.Ns(),super.willUpdate(e)}disconnectedCallback(){this.s.empty(),this.er?.[1].resolve(),this.$e?.delete(this),super.disconnectedCallback()}performAction(e){if(!this.action)return;let t,s=this.action;this.action.startsWith("toggle:")&&(s=this.Fs()),this.action.startsWith("seek:")&&(s="seek",t=this.tr+Number(this.action.split(":")[1])),this.dispatchEvent(b(`vds-${s}-request`,{bubbles:!0,composed:!0,detail:t,triggerEvent:e}))}Hs(){if(this.s.empty(),!this.ee||!this.type||!this.action)return;let e=0,t,s=(r=!1)=>{e+=1,window.clearTimeout(t),t=window.setTimeout(()=>{let p=this.er?.[1];r&&this.$e?.delete(this),A(this.ee),e=0,p?.resolve()},200)},i=f(this.ee,this.type,r=>{!this.Is(r)||(r.preventDefault(),e==0&&this.$e?.set(this,[r,E()]),s(e<this.repeat))});this.s.add(i)}Is(e){if(!this.whileIdle&&this.Zi)return!1;if(y(e)||g(e)||u(e)){let t=u(e)?e.touches[0]:void 0,s=t?.clientX??e.clientX,i=t?.clientY??e.clientY,r=this.getBoundingClientRect(),p=i>=r.top&&i<=r.bottom&&s>=r.left&&s<=r.right;return e.type.includes("leave")?!p:p}return!0}Ns(){if(!this.action?.startsWith("seek"))return;let e=this.q.currentTime.subscribe(t=>{this.tr=t});this.s.add(e)}get q(){return this.ei.value}Fs(){switch(this.action?.split(":")[1]){case"paused":return this.Be?"play":"pause";case"muted":return this.Be?"unmute":"mute";case"fullscreen":return`${this.Be?"exit":"enter"}-fullscreen`;default:return""}}Os(){if(!this.action?.startsWith("toggle:"))return;let e=this.action.split(":")[1],t=this.q[e]?.subscribe(s=>{this.Be=s});t&&this.s.add(t)}};c([l()],o.prototype,"type",2),c([l({type:Number})],o.prototype,"repeat",2),c([l({type:Number})],o.prototype,"priority",2),c([l()],o.prototype,"action",2),c([l({type:Boolean,attribute:"while-idle"})],o.prototype,"whileIdle",2);var d=new WeakSet;async function A(a){if(d.has(a))return;let n=h.get(a);if(!n)return;d.add(a);let e=Array.from(n.values()).map(i=>i[1].promise);await Promise.all(e);let t=Array.from(n.keys()),s=Math.min(...t.map(i=>i.priority));t.filter(i=>i.priority<=s).map(i=>{let r=n.get(i)[0];i.performAction(r)}),n.clear(),d.delete(a)}M("vds-gesture",o);
